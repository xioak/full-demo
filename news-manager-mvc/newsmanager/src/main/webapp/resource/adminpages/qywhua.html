<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <meta name="renderer" content="webkit">
    <title>公司及团队</title>
    <link rel="stylesheet" href="css/pintuer.css">
    <link rel="stylesheet" href="css/admin.css">
    <link href="/resource/umeditor1.2.3/themes/default/css/umeditor.css" type="text/css" rel="stylesheet">
    <script src="js/jquery.js"></script>
    <script src="js/pintuer.js"></script>

    <style>

        .main-con div {
            text-align: center;
            padding: 10px 10px;
        }

        .col-md-3 {
            width: 25%;
            float: left;
        }

        .main-con div a {
            display: inline-block;
            width: 78px;
            height: 78px;
            padding: 10px;
            border: 1px solid transparent;
            border: none \9;
            border-radius: 40px;
            -webkit-transition: all .7s linear;
            transition: all .7s linear;
        }

        .rotate-img {
            -webkit-animation-name: rotate;
            animation-name: rotate;
            -webkit-animation-timing-function: linear;
            animation-timing-function: linear;
            -webkit-animation-duration: 8000ms;
            animation-duration: 8000ms;
            -webkit-animation-iteration-count: infinite;
            animation-iteration-count: infinite;
            vertical-align: middle;
            border: 0;
        }

        .icon-part {
            position: relative;
            top: -47px;
        }

        .main-con div h4 {
            font-weight: bold;
            color: #666;
            -webkit-transition: all .3s linear;
            transition: all .3s linear;
        }

        .main-con div p {
            padding: 0;
            color: #666;
            font-size: 1.1em;
            margin-bottom: 5px;
        }

        .main-con div {
            text-align: center;
            padding: 10px 10px;
        }
    </style>

</head>
<body>

<div class="panel admin-panel">
    <div class="panel-head" id="add"><strong><span class="icon-pencil-square-o"></span>企业文化</strong></div>
    <div class="body-content">
        <div class="padding border-bottom">
            <button type="button" class="button border-green" id="panelAddBut">
                <span class="icon-plus-square-o"></span>新增
            </button>
        </div>
        <table class="table table-hover text-center">
            <thead>
            <tr>
                <th width="10%">编号</th>
                <th width="20%">主标题</th>
                <th width="15%">操作</th>
            </tr>

            </thead>
            <tbody>
        </table>
    </div>
</div>


<div class="panel admin-panel margin-top" style="display: none;">
    <div class="panel-head"><strong><span class="icon-pencil-square-o"></span>企业文化更新</strong></div>
    <div class="body-content">
        <div class=" col-md-3 main-con">
            <div class="cptdshow" style="text-align: center">
            </div>
        </div>
        <div class="col-md-5">
            <form method="post" class="form-x" action="">

                <div class="form-group">
                    <div class="label">
                        <label>标题一：</label>
                    </div>
                    <div class="field">
                        <input type="text" class="input" name="title" value=""/>
                        <div class="tips"></div>
                    </div>
                </div>

                <div class="form-group">
                    <div class="label">
                        <label>标题二：</label>
                    </div>
                    <div class="field">
                        <input type="text" class="input" name="subtitle" value=""/>
                        <div class="tips">换行用，隔开</div>
                    </div>
                </div>

                <div class="form-group">
                    <div class="label">
                        <label>ICON：</label>
                    </div>
                    <div class="field">
                        <input type="text" name="img" class="input tips" style="width:25%; float:left;" value=""
                               data-toggle="hover" data-place="right" data-image="" title="">
                        <input type="button" class="button bg-main icon-check-square-o bg-blue bg-main margin-left"
                               value="+ 浏览上传"
                               style="float:left;">
                        <input type="file" name="upfile" class="button bg-main icon-check-square-o bg-blue margin-left"
                               id="imageupload2" style="float: left;
              margin-left: -100px;
              width: 110px;
              opacity: 0;">
                        <div class="tipss">图片尺寸：32*32</div>
                    </div>
                </div>
                <div class="form-group">
                    <div class="label">
                        <label></label>
                    </div>
                    <div class="field">
                        <button class="button bg-main icon-check-square-o" type="submit" id="updateBut">更新</button>
                    </div>
                </div>
                <input type="hidden" name="type" value="102">
                <input type="hidden" name="id" value="0">
                <input type="hidden" name="imgurl" value="">
            </form>
        </div>

    </div>
</div>

<div class="panel admin-panel" style="display: none;">
    <div class="panel-head"><strong><span class="icon-pencil-square-o"></span>企业文化添加</strong></div>
    <div class="body-content">
        <form method="post" class="form-x" action="" id="data_form">

            <div class="form-group">
                <div class="label">
                    <label>标题一：</label>
                </div>
                <div class="field">
                    <input type="text" class="input" name="title" value=""/>
                    <div class="tips"></div>
                </div>
            </div>

            <div class="form-group">
                <div class="label">
                    <label>标题二：</label>
                </div>
                <div class="field">
                    <input type="text" class="input" name="subtitle" value=""/>
                    <div class="tips">换行用，隔开</div>
                </div>
            </div>

            <div class="form-group">
                <div class="label">
                    <label>ICON：</label>
                </div>
                <div class="field">
                    <input type="text" id="url1" name="img" class="input tips" style="width:25%; float:left;" value=""
                           data-toggle="hover" data-place="right" data-image="" title="">
                    <input type="button" class="button bg-main icon-check-square-o bg-blue bg-main margin-left"
                           id="image1" value="+ 浏览上传"
                           style="float:left;">
                    <input type="file" name="upfile" class="button bg-main icon-check-square-o bg-blue margin-left"
                           id="imageupload" style="float: left;
              margin-left: -100px;
              width: 110px;
              opacity: 0;">
                    <div class="tipss">图片尺寸：32*32</div>
                </div>
            </div>
            <div class="form-group">
                <div class="label">
                    <label></label>
                </div>
                <div class="field">
                    <button class="button bg-main icon-check-square-o" type="submit" id="addBut"> 提交</button>
                </div>
            </div>
            <input type="hidden" name="type" value="102">
            <input type="hidden" name="id" value="0">
            <input type="hidden" name="imgurl" value="">
            <input type="hidden" name="cpId" value="0">
        </form>
    </div>
</div>

<script type="text/javascript" src="/resource/umeditor1.2.3/third-party/jquery.min.js"></script>

<script>

    var qywnApp = {

        init: function () {

            this.listdata();
            this.qywm_add();
            this.imgFileBut();
            this.qywn_update();

        },

        param: {page: 1, type: 102, pageSize: 500},

        listdata: function () {
            this.panels = $("div.panel");
            var _this = this;
            $.get("/cpbase/base/qywm/list", this.param, function (data) {
                var html = "";
                $.each(data.resultData, function (i, o) {
                    html +=
                        '<tr><td>' + o.id + '</td><td>' + o.data.title + '</td><td></td>'
                        + '<td><div class="button-group"> ' +
                        '<a class="button border-main" href="javascript:void(0)">' +
                        '<span class="icon-edit"></span>查看</a>' +
                        '<a class="button border-red" href="javascript:void(0)">' +
                        '<span class="icon-trash-o"></span>删除</a></div></td></tr>';
                });

                var tbody = _this.panels.eq(0).find("table").find("tbody");
                tbody.empty().append(html);
                //分页按钮
//             this.userPager(data, tbody);
                _this.list_but_operate(tbody);
            });
        },

        list_but_operate: function (tbody) {
            var panels = this.panels;
            var _this = this;
            tbody.find("a.border-main").click(function () {
                _this.qywn_detail($(this), panels);
            });
            tbody.find("a.border-red").click(function () {
                _this.qywh_delete($(this), panels);
            });
        },

        qywm_add: function () {

            var _this = this;
            $("#panelAddBut").click(function () {
                _this.panels.hide();
                _this.panels.eq(2).show();
            });

            $("#addBut").click(function () {
                var form = $(this).parents("form");
                form.removeAttr("enctype");
                $.post("/cpbase/base/qywm/add", form.serialize(), function (data) {

                })

            });
        },

        qywn_detail: function (obj, panels) {
            var id = obj.parents("tr").find("td").eq(0).text();
            var sutt = "";
            $.get("/cpbase/base/cptd/get", {"type": "102", "id": id}, function (data) {
                console.log(data);
//                    return;

                var data = data.resultData;
                var html =
                    " <a href='#'>" +
                    " <img class='rotate-img' src='images/gear.png' alt='gear'>" +
                    " <img class='icon-part' src='" + data.content.imgurl + "' alt='icon'>" +
                    " </a>" +
                    " <h4>" + data.content.title + "</h4>";
                $.each(data.content.subtitle, function (i, o) {
                    html += " <p>" + o + "</p>";
                    sutt += o + ",";
                });

                var panel = panels.eq(1);

                panel.find("div.cptdshow").empty().append($(html));
                var form = panel.find("form");
                form.find("input[name='title']").val(data.content.title);
                form.find("input[name='id']").val(data.info.id);
                form.find("input[name='imgurl']").val(data.content.imgurl);
                form.find("input[name='subtitle']").val(sutt.substring(0, sutt.length - 1));
                panel.show();

            })
        },

        qywn_update: function (obj, panels) {
            $("#updateBut").click(function () {
                var form = $(this).parents("form");
                form.removeAttr("enctype");
                $.post("/cpbase/base/qywm/add", form.serialize(), function (data) {

                })
            });
        },

        qywh_delete: function (obj, panels) {

            if(!confirm("是否删除该条数据？")){
                return ;
            }
            var id = obj.parents("tr").find("td").eq(0).text();
            $.post("/cpbase/base/cptd/delete", {"type": "102", "id": id}, function (data) {
                obj.parents("tr").remove();
                panels.eq(1).hide();
            });
        },


        imgFileBut: function () {
            var _this = this;
            $("#imageupload").change(function () {
                _this.iconUpload($(this));
            });
            $("#imageupload2").change(function () {
                _this.iconUpload($(this));
            });
        },


        iconUpload: function ($this) {
            var form = $this.parents("form");
            form.attr("enctype", "multipart/form-data");
            $.ajax({
                url: '/ueditor/images/upload',
                type: 'POST',
                cache: false,
                data: new FormData(form[0]),
                processData: false,
                contentType: false
            }).done(function (res) {
                form.find("input[name='imgurl']").val($.parseJSON(res).url);
            }).fail(function (res) {
                alert(res);
            });
        }

    }

    $(function () {
        qywnApp.init();
    })

</script>
</body>
</html>
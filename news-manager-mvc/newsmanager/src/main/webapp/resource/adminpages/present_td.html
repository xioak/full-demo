<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <meta name="renderer" content="webkit">
    <title></title>
    <link rel="stylesheet" href="css/pintuer.css">
    <link rel="stylesheet" href="css/admin.css">
    <link href="/resource/umeditor1.2.3/themes/default/css/umeditor.css" type="text/css" rel="stylesheet">
    <script src="js/jquery.js"></script>
    <script src="js/pintuer.js"></script>
</head>
<body>
<div class="panel admin-panel">
    <div class="panel-head"><strong><span class="icon-pencil-square-o"></span>产品列表</strong></div>
    <div class="body-content">
        <table class="table table-hover text-center">
            <thead>
            <tr>
                <th width="10%">编号</th>
                <th width="20%">产品名称</th>
                <th width="15%">创建时间</th>
                <th width="15%">操作</th>
            </tr>
            </thead>

            <tbody>
            <tr>
                <td colspan="8">
                    <div class="pagelist"><a>上一页</a>
                        <span class="current">1</span>
                        <a>2</a>
                        <a href="">3</a>
                        <a href="">下一页</a>
                        <a href="">尾页</a></div>
                </td>
            </tr>
            </tbody>
        </table>

    </div>
</div>
<div class="panel admin-panel" id="td_list_panle" style="display: none;">
    <div class="panel-head" id="add"><strong><span class="icon-pencil-square-o"></span>特点列表</strong></div>
    <div class="body-content">
        <div class="padding border-bottom">
            <button type="button" class="button border-green" id="cptdaddBut">
                <span class="icon-plus-square-o"></span>添加特点
            </button>
        </div>
        <table class="table table-hover text-center">
            <thead>
            <tr>
                <th width="10%">编号</th>
                <th width="20%">特点主标题</th>
                <th width="15%">创建时间</th>
                <th width="15%">操作</th>
            </tr>

            </thead>
            <tbody>
        </table>
    </div>
</div>

<div class="panel admin-panel" id="td_add_panel" style="display: none;">
    <div class="panel-head"><strong><span class="icon-pencil-square-o"></span>添加特点</strong></div>
    <div class="body-content">
        <form method="post" class="form-x" action="" id="data_form">
            <div class="form-group">
                <div class="label">
                    <label>产品名称：</label>
                </div>
                <div class="field">
                    <input type="text" class="input" name="cpname" value=""/>
                    <input type="hidden" name="cpId">
                    <div class="tips" title=""></div>
                </div>
            </div>

            <div class="form-group">
                <div class="label">
                    <label>标题一：</label>
                </div>
                <div class="field">
                    <input type="text" class="input" name="title" value=""/>
                    <div class="tips"></div>
                </div>
            </div>

            <div class="form-group">
                <div class="label">
                    <label>标题二：</label>
                </div>
                <div class="field">
                    <input type="text" class="input" name="subtitle" value=""/>
                    <div class="tips">换行用，隔开</div>
                </div>
            </div>

            <div class="form-group">
                <div class="label">
                    <label>ICON：</label>
                </div>
                <div class="field">
                    <input type="text" id="url1" name="img" class="input tips" style="width:25%; float:left;" value=""
                           data-toggle="hover" data-place="right" data-image="" title="">
                    <input type="button" class="button bg-main icon-check-square-o bg-blue bg-main margin-left"
                           id="image1" value="+ 浏览上传"
                           style="float:left;">
                    <input type="file" name="upfile" class="button bg-main icon-check-square-o bg-blue margin-left"
                           id="imageupload" style="float: left;
              margin-left: -100px;
              width: 110px;
              opacity: 0;">
                    <div class="tipss">图片尺寸：32*32</div>
                </div>
            </div>
            <div class="form-group">
                <div class="label">
                    <label></label>
                </div>
                <div class="field">
                    <button class="button bg-main icon-check-square-o" type="submit" id="cptdAdd"> 提交</button>
                </div>
            </div>
            <input type="hidden" name="type" id="baseType" value="104">
            <input type="hidden" name="id" value="0">
            <input type="hidden" name="imgurl" value="">
        </form>
    </div>
</div>

<div class="panel admin-panel margin-top" style="display: none;">
    <div class="panel-head"><strong><span class="icon-pencil-square-o"></span>产品特点</strong></div>
    <div class="body-content">
        <div class=" col-md-3 main-con">
            <div class="cptdshow" style="text-align: center">
            </div>
        </div>
        <div class="col-md-5">
            <form method="post" class="form-x" action="">

                <div class="form-group">
                    <div class="label">
                        <label>标题一：</label>
                    </div>
                    <div class="field">
                        <input type="text" class="input" name="title" value=""/>
                        <div class="tips"></div>
                    </div>
                </div>

                <div class="form-group">
                    <div class="label">
                        <label>标题二：</label>
                    </div>
                    <div class="field">
                        <input type="text" class="input" name="subtitle" value=""/>
                        <div class="tips">换行用，隔开</div>
                    </div>
                </div>

                <div class="form-group">
                    <div class="label">
                        <label>ICON：</label>
                    </div>
                    <div class="field">
                        <input type="text" name="img" class="input tips" style="width:25%; float:left;" value=""
                               data-toggle="hover" data-place="right" data-image="" title="">
                        <input type="button" class="button bg-main icon-check-square-o bg-blue bg-main margin-left"
                               value="+ 浏览上传"
                               style="float:left;">
                        <input type="file" name="upfile" class="button bg-main icon-check-square-o bg-blue margin-left"
                               id="imageupload2" style="float: left;
              margin-left: -100px;
              width: 110px;
              opacity: 0;">
                        <div class="tipss">图片尺寸：32*32</div>
                    </div>
                </div>
                <div class="form-group">
                    <div class="label">
                        <label></label>
                    </div>
                    <div class="field">
                        <button class="button bg-main icon-check-square-o" type="submit" id="cptdUpdate">更新</button>
                    </div>
                </div>
                <input type="hidden" name="type" value="104">
                <input type="hidden" name="id" value="0">
                <input type="hidden" name="imgurl" value="">
            </form>
        </div>

    </div>
</div>



<script>

    $(function () {

        var newsManage = {
            param: {
                page: 1, type: 4, pageSize: 5
            },
            panels: "",
            getCplist: function () {
                this.panels = $("div.panel");
                var _this = this;
                $.get("/content/list", this.param, function (data) {
                    _this.CplistTab(data);
                });

            },

            CplistTab: function (data) {
                var html = "";
                $.each(data.resultData.newsList, function (i, o) {
                    html +=
                        '<tr><td>' + o.id + '</td><td>' + o.title + '</td><td>' + o.creatTime + '</td>'
                        + '<td><div class="button-group"> ' +
                        '<a class="button border-main" href="javascript:void(0)">' +
                        '<span class="icon-edit"></span>查看特点列表</a></div></td></tr>'
                });

                var tbody = this.panels.eq(0).find("table").find("tbody");
                tbody.empty().append(html);
                //分页按钮
                this.userPager(data, tbody);
                this.CplistButOperate(tbody);
            },

            CplistButOperate: function (tbody) {
                var _this = this;
                tbody.find("a.border-main").click(function () {
                    _this.getCptdList($(this));
                });
            },

            getCptdList: function ($this) {
                var idtr = $this.parents("tr").find("td");
                var id = idtr.eq(0).text();
                var url = "/cpbase/base/cptd/list";
                var param = {"type": "104", "cpId": id};
                var _this = this;
                var panels = this.panels;
                $.get(url, param, function (data) {
                    var tdata = data.resultData;
                    panels.hide();

                    var panel = panels.eq(2);
                    panel.find("input[name='cpname']").val(idtr.eq(1).text())
                    panel.find("input[name='cpId']").val(idtr.eq(0).text())

                    if (!tdata || tdata.length == 0) {
                        alert("该产品暂无特点数据，请添加");
                        panel.show();

                    } else {
                        _this.CptdListTab(data.resultData, idtr.eq(0).text());
                    }

                });
            },

            CptdListTab: function (data, cpId) {
                var html = "";
                var _this = this;
                $.each(data, function (i, o) {
                    html +=
                        '<tr><td>' + o.id + '</td><td>' + o.data.title + '</td><td></td>'
                        + '<td><input type="hidden" value="' + o + '"><div class="button-group"> ' +
                        '<a class="button border-main" href="javascript:void(0)">' +
                        '<span class="icon-edit"></span>查看</a> ' +
                        '<a class="button border-red" href="javascript:void(0)">' +
                        '<span class="icon-trash-o"></span>删除</a></div></td></tr>'
                });
                var panel = this.panels.eq(1);
                var tbody = panel.find("table").find("tbody").empty().append(html);

                $("#cptdaddBut").attr("cpid", cpId);
                panel.show();

                this.CptdListButOperat(tbody);
            },

            CptdListButOperat: function (tbody) {

                var panels = this.panels;
                var _this = this;
                tbody.find("a.border-main").click(function () {
                    _this.CptdUpdata($(this), panels);
                });
                tbody.find("a.border-red").click(function () {
                    _this.CptdDelete($(this), panels);
                });

            },

            CptdUpdata: function ($this, panels) {

                var id = $this.parents("tr").find("td").eq(0).text();
                var sutt = "";
                $.get("/cpbase/base/cptd/get", {"type": "104", "id": id}, function (data) {
                    console.log(data);
//                    return;

                    var data = data.resultData;
                    var html =
                        " <a href='#'>" +
                        " <img class='rotate-img' src='images/gear.png' alt='gear'>" +
                        " <img class='icon-part' src='" + data.content.imgurl + "' alt='icon'>" +
                        " </a>" +
                        " <h4>" + data.content.title + "</h4>";
                    $.each(data.content.subtitle, function (i, o) {
                        html += " <p>" + o + "</p>";
                        sutt += o + ",";
                    });

                    var panel = panels.eq(3);

                    panel.find("div.cptdshow").empty().append($(html));
                    var form = panel.find("form");
                    form.find("input[name='title']").val(data.content.title);
                    form.find("input[name='id']").val(data.info.id);
                    form.find("input[name='imgurl']").val(data.content.imgurl);
                    form.find("input[name='subtitle']").val(sutt.substring(0, sutt.length - 1));
                    panels.eq(3).show();

                })


            },

            CptdDelete: function ($this, panels) {

                var id = $this.parents("tr").find("td").eq(0).text();
                $.post("/cpbase/base/cptd/delete", {"type": "104", "id": id}, function (data) {
                    $this.parents("tr").remove();
                    panels.eq(3).hide();
                });
            },

            userPager: function (data, tbody) {

                var _this = this;
                var pagehtml = '<tr id="pagerrow"><td colspan="8"><div class="pagelist">';
                var pagedata = data.resultData.page;
                if (pagedata.first) {
                    pagehtml += '<a nopage="0">上一页</a>'
                } else {
                    pagehtml += '<a>上一页</a>'
                }

                $.each(pagedata.pagelist, function (i, o) {

                    if (o === pagedata.curre) {
                        pagehtml += '<span class="current">' + o + '</span>'
                    } else {
                        pagehtml += '<a>' + o + '</a>';
                    }
                })

                if (pagedata.last) {
                    pagehtml += '<a nopage="0">下一页</a></div></td><tr>'
                } else {
                    pagehtml += '<a>下一页</a></div></td><tr>'
                }

                tbody.append($(pagehtml));

                // 翻页
                $("#pagerrow").find("a").click(function () {

                    if ($(this).attr("nopage") == 0) {
                        return;
                    }

                    var pageno = $(this).text();

                    if (pageno == "上一页") {
                        pageno = $("#new_tb_pager").find("span").text() * 1 - 1;
                    }
                    if (pageno == "下一页") {
                        pageno = $("#new_tb_pager").find("span").text() * 1 + 1;
                    }
                    _this.param.page = pageno;
                    _this.param.userPager = true;
                    _this.getCplist();

                });
            },

            CptdAddPanel: function (panles) {

                var _this = this;

                $("#cptdAdd").click(function () {
                    var form = $(this).parents("form");
                    form.removeAttr("enctype");
                    $.post("/cpbase/base/qywm/add", form.serialize(), function (data) {

                    })

                });

                $("#cptdaddBut").click(function () {

                    _this.panels.hide();
                    _this.panels.eq(2).find("form").find("input[name='cpId']").val($(this).attr("cpid"));
                    _this.panels.eq(2).show();
                });

                $("#cptdUpdate").click(function () {
                    var form = $(this).parents("form");
                    form.removeAttr("enctype");
                    $.post("/cpbase/base/qywm/add", form.serialize(), function (data) {

                    })

                });

                $("#imageupload").change(function () {
                    var form = $(this).parents("form");
                    form.attr("enctype", "multipart/form-data");

                    $.ajax({
                        url: '/ueditor/images/upload',
                        type: 'POST',
                        cache: false,
                        data: new FormData(form[0]),
                        processData: false,
                        contentType: false
                    }).done(function (res) {
                        form.find("input[name='imgurl']").val($.parseJSON(res).url);
                    }).fail(function (res) {
                        alert(res);

                    });
                });

                $("#imageupload2").change(function () {
                    var form = $(this).parents("form");
                    form.attr("enctype", "multipart/form-data");
                    $.ajax({
                        url: '/ueditor/images/upload',
                        type: 'POST',
                        cache: false,
                        data: new FormData(form[0]),
                        processData: false,
                        contentType: false
                    }).done(function (res) {
                        form.find("input[name='imgurl']").val($.parseJSON(res).url);
                    }).fail(function (res) {
                        alert(res);

                    });
                })


            }
        }


        //获取产品列表
        newsManage.getCplist();

        newsManage.CptdAddPanel();

    })

</script>
</body>
</html>


